<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Jurnal Trading</title>

<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon192.png">
<link rel="apple-touch-icon" href="icon192.png">
<meta name="theme-color" content="#0f172a">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:#0f172a;
  color:#e5e7eb;
  padding:14px;
}
body.light{background:#f3f4f6;color:#111827}

.container{max-width:480px;margin:auto}
.card{
  background:#1e293b;
  border-radius:14px;
  padding:12px;
  margin-bottom:10px;
}
body.light .card{background:#fff}

input,select,textarea,button{
  width:100%;
  padding:10px 12px;
  margin:4px 0;
  border-radius:10px;
  border:none;
  font-size:14px;
}

input,select,textarea{
  background:#020617;
  color:#e5e7eb;
}
body.light input,
body.light select,
body.light textarea{
  background:#f9fafb;
  color:#111827;
  border:1px solid #e5e7eb;
}

.form-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
}

button{
  background:#22c55e;
  font-weight:700;
  cursor:pointer;
}

.actions{
  display:flex;
  gap:8px;
  margin-bottom:10px;
}

.trade{
  display:flex;
  justify-content:space-between;
  gap:10px;
}

.small{font-size:12px;color:#94a3b8}
.pl.plus{color:#22c55e}
.pl.minus{color:#ef4444}

.badge{
  padding:3px 10px;
  border-radius:999px;
  font-size:12px;
}
.badge.TP{background:#14532d;color:#bbf7d0}
.badge.SL{background:#7f1d1d;color:#fecaca}
.badge.BEP{background:#78350f;color:#fde68a}

button.edit{background:#334155;color:#fff}
button.delete{background:#7f1d1d;color:#fecaca}
</style>
</head>

<body>
<div class="container">

<h2>üìä Jurnal Trading</h2>

<div class="card">
  <input id="date" type="date">
  <input id="stock" placeholder="Kode Saham (BBRI)">
  <div class="form-grid">
    <input id="qty" type="number" placeholder="Qty (Lot)">
    <input id="modal" type="number" placeholder="Modal (Rp)">
  </div>
  <div class="form-grid">
    <input id="entry" type="number" placeholder="Entry">
    <input id="exit" type="number" placeholder="Exit">
  </div>
  <input id="sl" type="number" placeholder="Stop Loss (opsional)">
  <textarea id="note" rows="2" placeholder="Catatan (opsional)"></textarea>
  <button onclick="saveTrade()">‚ûï Simpan Trade</button>
</div>

<div class="card">
  Total Trade: <b id="count">0</b><br>
  Total P/L: <b id="total">0</b><br>
  Win Rate: <b id="winrate">0%</b><br>
  BEP: <b id="bepcount">0</b>
</div>

<div class="actions">
  <button onclick="exportCSV()">üíæ Export CSV</button>
  <button onclick="toggleTheme()">üåì Theme</button>
</div>

<h3>üìã History</h3>
<div id="list"></div>

</div>

<script>
date.valueAsDate = new Date();
let trades = JSON.parse(localStorage.getItem("trades")) || [];
let editIndex = null;

function saveTrade(){
  const qtyVal = +qty.value;
  const entryVal = +entry.value;
  const exitVal = +exit.value;
  const slVal = +sl.value;
  const modalVal = +modal.value;

  if(qtyVal<=0 || entryVal<=0 || exitVal<=0){
    alert("Qty, Entry, Exit wajib diisi");
    return;
  }

  let result="BEP", pl=0, percent=0, riskPercent=0;

  if(exitVal === entryVal){
    result="BEP";
  }else{
    if(exitVal > entryVal){
      result="TP";
      pl=(exitVal-entryVal)*qtyVal*100;
    }else{
      result="SL";
      pl=(exitVal-entryVal)*qtyVal*100;
    }
    percent=(pl/(entryVal*qtyVal*100))*100;
  }

  if(result!=="BEP" && slVal && modalVal){
    const riskRp=Math.abs(entryVal-slVal)*qtyVal*100;
    riskPercent=(riskRp/modalVal)*100;
  }

  const data={
    date:date.value,
    stock:stock.value.toUpperCase(),
    qty:qtyVal,
    entry:entryVal,
    exit:exitVal,
    sl:slVal||"",
    modal:modalVal||"",
    result,pl,percent,riskPercent,
    note:note.value
  };

  if(editIndex!==null){
    trades[editIndex]=data;
    editIndex=null;
  }else{
    trades.unshift(data);
  }

  localStorage.setItem("trades",JSON.stringify(trades));
  resetForm();
  render();
}

function resetForm(){
  stock.value=qty.value=entry.value=exit.value=sl.value=modal.value=note.value="";
  date.valueAsDate=new Date();
}

function editTrade(i){
  const t=trades[i];
  date.value=t.date;
  stock.value=t.stock;
  qty.value=t.qty;
  entry.value=t.entry;
  exit.value=t.exit;
  sl.value=t.sl;
  modal.value=t.modal;
  note.value=t.note;
  editIndex=i;
  window.scrollTo({top:0,behavior:"smooth"});
}

function deleteTrade(i){
  if(confirm("Hapus trade ini?")){
    trades.splice(i,1);
    localStorage.setItem("trades",JSON.stringify(trades));
    render();
  }
}

function render(){
  list.innerHTML="";
  let tp=0,slc=0,bep=0,total=0;

  trades.forEach((t,i)=>{
    total+=t.pl;
    if(t.result==="TP") tp++;
    if(t.result==="SL") slc++;
    if(t.result==="BEP") bep++;

    list.innerHTML+=`
<div class="card trade">
  <div>
    <b>${t.stock}</b>
    <div class="small">${t.date}</div>
    <span class="badge ${t.result}">${t.result}</span>
  </div>
  <div style="text-align:right">
    <div class="pl ${t.pl>=0?'plus':'minus'}">${t.pl.toLocaleString()}</div>
    <div class="small">${t.percent.toFixed(2)}% ‚Ä¢ Risk ${t.riskPercent.toFixed(2)}%</div>
    <div style="margin-top:6px">
      <button class="edit" onclick="editTrade(${i})">‚úèÔ∏è</button>
      <button class="delete" onclick="deleteTrade(${i})">üóë</button>
    </div>
  </div>
</div>`;
  });

  count.textContent=trades.length;
  total.textContent=total.toLocaleString();
  winrate.textContent=(tp+slc)?Math.round(tp/(tp+slc)*100)+"%":"0%";
  bepcount.textContent=bep;
}

function exportCSV(){
  if(!trades.length){alert("Belum ada data");return;}
  let csv="Date,Stock,Qty,Entry,Exit,SL,Modal,Result,PL,Percent,Risk%,Note\n";
  trades.forEach(t=>{
    csv+=`${t.date},${t.stock},${t.qty},${t.entry},${t.exit},${t.sl},${t.modal},${t.result},${t.pl},${t.percent.toFixed(2)},${t.riskPercent.toFixed(2)},"${t.note}"\n`;
  });
  const a=document.createElement("a");
  a.href="data:text/csv;charset=utf-8,"+encodeURIComponent(csv);
  a.download="jurnal_trading.csv";
  a.click();
}

function toggleTheme(){
  document.body.classList.toggle("light");
}

render();
</script>

</body>
</html>
